import{u as zt,c as W,a as ie,b as Kt,d as le,e as Y,g as s,f as c,i as n,h as a,s as Re,F as J,S as g,j as _,o as B,r as j,n as I,k as T,l as F,m as Qt,t as x,p as Dt}from"./main-CXeWjMn0.js";import{g as Gt,m as Ht,u as Lt,r as Yt,H as Jt,a as Ut}from"./header-Q6tATL8l.js";var Oe=x('<span class="text-xs text-stone-600 italic self-center">No captures'),Xt=x('<button class="w-full mt-4 bg-stone-700 hover:bg-stone-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-black/20 transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2"><span>↺</span> Takeback'),ze=x("<span>..."),Ke=x('<div class="flex gap-2 w-full mt-4"><button class="flex-1 bg-emerald-600 hover:bg-emerald-500 disabled:bg-emerald-800 disabled:cursor-not-allowed text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"></button><button class="flex-1 bg-stone-600 hover:bg-stone-500 disabled:opacity-50 text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"><span>✕</span> Cancel'),Vt=x('<div class="bg-red-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold animate-bounce flex items-center gap-2 border-4 border-stone-900"><span>⚠️</span> <!$><!/>'),Zt=x('<div class="bg-emerald-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold flex items-center gap-2 border-4 border-stone-900"><span>✨</span> <!$><!/>'),en=x('<div class="absolute inset-0 bg-stone-900/80 flex items-center justify-center z-50 backdrop-blur-md"><div class="bg-stone-800 p-12 rounded-3xl shadow-[0_0_100px_rgba(0,0,0,0.5)] text-center border-b-8 border-indigo-600 animate-in fade-in zoom-in duration-500"><h2 class="text-6xl font-black text-stone-100 mb-4 tracking-tighter"></h2><p class="text-2xl font-bold text-indigo-400 mb-10 tracking-wide uppercase"></p><button class="px-10 py-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl font-black text-xl shadow-2xl transition-all transform hover:-translate-y-2 active:translate-y-0">New Challenge'),tn=x('<button class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-black/20 transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2"><span>↺</span> Takeback'),nn=x('<span class="text-stone-600 text-sm italic">Waiting for start...'),rn=x('<div class="min-h-screen bg-gradient-to-br from-stone-900 via-stone-900 to-black font-sans text-stone-200 flex flex-col"><!$><!/><div class="flex-1 flex flex-col items-center justify-center p-4 lg:p-8 overflow-hidden relative"><div class="flex flex-col xl:flex-row items-center justify-center gap-8 w-full max-w-[1800px]"><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-2 xl:order-1"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-black rounded-2xl shadow-inner flex items-center justify-center text-stone-200 font-bold border-4 border-stone-700 text-3xl mb-2">B</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">Black</div><div></div><div></div></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div><!$><!/></div></div><div class="relative group order-1 xl:order-2"><div class="absolute -top-16 left-0 w-full flex justify-center h-12 pointer-events-none z-30"><!$><!/><!$><!/></div><div class="w-[80vw] h-[80vw] max-w-[800px] max-h-[800px] bg-stone-700 rounded-xl shadow-2xl overflow-hidden border-[16px] border-stone-950 relative select-none"><div class="grid grid-cols-8 grid-rows-[repeat(8,1fr)] w-full h-full transition-transform duration-1000 cubic-bezier(0.4, 0, 0.2, 1)"></div><!$><!/></div></div><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-3"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-stone-200 border-4 border-stone-500 rounded-2xl shadow-md flex items-center justify-center text-stone-900 font-bold text-3xl mb-2">W</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">White</div><div></div><div></div></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div><!$><!/></div></div></div></div><div class="bg-stone-900 border-t border-stone-800 p-2 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.5)] z-40"><div class="max-w-[1800px] mx-auto flex items-center gap-4 overflow-x-auto scrollbar-thin scrollbar-thumb-stone-600 scrollbar-track-stone-900 px-4 pb-2"><div class="text-xs font-black text-stone-500 uppercase tracking-widest px-3 py-1 bg-stone-800 rounded-md shrink-0">History</div><div class="flex items-center gap-6 px-2 min-w-max"><!$><!/><!$><!/><div id=move-anchor class=w-2>'),Qe=x('<span class="text-3xl filter drop-shadow-sm text-stone-400 hover:scale-125 transition-transform cursor-help">'),De=x("<span>✓ Submit"),Ge=x("<span>"),ln=x('<div class="absolute inset-0 bg-yellow-500/60 pointer-events-none mix-blend-hard-light">'),on=x("<button><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),sn=x('<div class="absolute inset-0 border-[6px] sm:border-[8px] border-rose-500/50 rounded-full m-1 sm:m-2 pointer-events-none animate-pulse">'),an=x('<div class="w-4 h-4 sm:w-6 sm:h-6 bg-stone-900/40 rounded-full pointer-events-none">'),dn=x('<span class="text-4xl sm:text-5xl md:text-7xl drop-shadow-2xl transition-all duration-700 ease-in-out cursor-pointer hover:scale-110 active:scale-90 transform-gpu z-20">'),cn=x('<span class="font-bold text-stone-300 px-2 py-0.5 rounded hover:bg-stone-800 transition-colors cursor-pointer ml-1">'),un=x('<div class="flex items-center text-sm font-mono"><span class="text-stone-600 mr-2 select-none group-hover:text-stone-500 transition-colors"><!$><!/>.</span><span class="font-bold text-stone-300 px-2 py-0.5 rounded hover:bg-stone-800 transition-colors cursor-pointer"></span><!$><!/>');const oe={White:{Pawn:"♙",Knight:"♘",Bishop:"♗",Rook:"♖",Queen:"♕",King:"♔"},Black:{Pawn:"♟",Knight:"♞",Bishop:"♝",Rook:"♜",Queen:"♛",King:"♚"}};function bn(){const se=zt(),[R,ae]=W(0),He=()=>{if(typeof window<"u")try{const e=localStorage.getItem("chess_pending_move");return e?JSON.parse(e):null}catch(e){console.error("Failed to parse pending move",e)}return null},[w,O]=W(He());ie(()=>{if(typeof window<"u"){const e=w();e?localStorage.setItem("chess_pending_move",JSON.stringify(e)):localStorage.removeItem("chess_pending_move")}});const r=Kt(()=>({queryKey:["board"],queryFn:async()=>{try{return await Gt({data:{mode:"vs_player"}})}catch(e){throw console.error("✗ Failed to fetch board:",e),e}},staleTime:0,refetchOnWindowFocus:!0})),k=le(()=>({mutationFn:e=>{if(!r.data?.id)throw new Error("Game ID not found");return Ht({data:{...e.data,gameId:r.data.id}})},onSuccess:async()=>{await se.invalidateQueries({queryKey:["board"]}),O(null)},onError:e=>{const f=e&&typeof e=="object"&&"message"in e?e.message:String(e);S(`Move failed: ${f}`),setTimeout(()=>S(null),3e3)}})),z=le(()=>({mutationFn:()=>{if(!r.data?.id)throw new Error("Game ID not found");return Lt({data:{gameId:r.data.id}})},onSuccess:async()=>{await se.invalidateQueries({queryKey:["board"]}),setTimeout(()=>Ue(null),2e3)},onError:e=>{S(`Undo failed: ${e.message}`),setTimeout(()=>S(null),3e3)}})),de=le(()=>({mutationFn:e=>Yt({data:e}),onSuccess:async()=>{await r.refetch(),q(null),E([]),O(null),S(null)},onError:e=>{S(`Failed to reset game: ${e instanceof Error?e.message:String(e)}`)}})),[ce,Le]=W(Date.now());ie(()=>{const e=setInterval(()=>{Le(Date.now())},100);return()=>clearInterval(e)});const ue=e=>{if(r.data?.timeControl===0)return"∞";const f=Math.max(0,Math.floor(e/1e3)),b=Math.floor(f/60),p=f%60;return`${b}:${p.toString().padStart(2,"0")}`},Ye=Y(()=>{if(!r.data)return 0;const{turn:e,status:f,whiteTimeRemaining:b,lastMoveTime:p,timeControl:v}=r.data;if(v===0)return Number.MAX_SAFE_INTEGER;if(e==="White"&&f==="Ongoing"&&p){const N=ce()-p;return Math.max(0,b-N)}return b}),Je=Y(()=>{if(!r.data)return 0;const{turn:e,status:f,blackTimeRemaining:b,lastMoveTime:p,timeControl:v}=r.data;if(v===0)return Number.MAX_SAFE_INTEGER;if(e==="Black"&&f==="Ongoing"&&p){const N=ce()-p;return Math.max(0,b-N)}return b}),ge=Y(()=>{const e=r.data?.pieces||[],f=w();return f?e.filter(b=>b.square!==f.to).map(b=>b.square===f.from?{...b,square:f.to}:b):e}),$=Y(()=>r.data?.turn||"White");ie(()=>{$()==="Black"?ae(180):ae(0)});const[K,q]=W(null),[xe,E]=W([]),[be,S]=W(null),[fe,Ue]=W(null),he=e=>ge().find(f=>f.square===e),Xe=async e=>{if(!r.data||r.data.status!=="Ongoing"||w())return;const b=ge().find(v=>v.square===e),p=K();if(b&&b.color===r.data.turn){if(p===e){q(null),E([]);return}q(e),S(null);try{if(!r.data?.id)return;const v=await Ut({data:{square:e,gameId:r.data.id}});E(Array.isArray(v)?v:[])}catch(v){console.error("✗ Failed to fetch moves:",v),S(`API Error: ${v?.message||"Unknown error"}`),E([])}return}p!==null&&(xe().includes(e)?(O({from:p,to:e}),q(null),E([])):(q(null),E([])))},me=()=>{const e=w();e&&k.mutate({data:e})},$e=()=>{O(null)},ve=e=>{de.mutate(e||{mode:"vs_player",timeControl:10})};return(()=>{var e=s(rn),f=e.firstChild,[b,p]=c(f.nextSibling),v=b.nextSibling,N=v.firstChild,pe=N.firstChild,_e=pe.firstChild,Ve=_e.firstChild,we=Ve.nextSibling,Ze=we.firstChild,U=Ze.nextSibling,Se=U.nextSibling,Q=we.nextSibling,et=Q.firstChild,[ye,tt]=c(et.nextSibling),nt=ye.nextSibling,[rt,it]=c(nt.nextSibling),lt=Q.nextSibling,[ot,st]=c(lt.nextSibling),ke=pe.nextSibling,D=ke.firstChild,at=D.firstChild,[Ce,dt]=c(at.nextSibling),ct=Ce.nextSibling,[ut,gt]=c(ct.nextSibling),Me=D.nextSibling,X=Me.firstChild,xt=X.nextSibling,[bt,ft]=c(xt.nextSibling),ht=ke.nextSibling,Pe=ht.firstChild,mt=Pe.firstChild,We=mt.nextSibling,$t=We.firstChild,V=$t.nextSibling,Te=V.nextSibling,G=We.nextSibling,vt=G.firstChild,[Ee,pt]=c(vt.nextSibling),_t=Ee.nextSibling,[wt,St]=c(_t.nextSibling),yt=G.nextSibling,[kt,Ct]=c(yt.nextSibling),Mt=v.nextSibling,Pt=Mt.firstChild,Wt=Pt.firstChild,Z=Wt.nextSibling,Tt=Z.firstChild,[Be,Et]=c(Tt.nextSibling),Bt=Be.nextSibling,[je,jt]=c(Bt.nextSibling);return je.nextSibling,n(e,a(Jt,{onRestart:ve,get isRestarting(){return de.isPending},activeMode:"vs_player",get currentTimeControl(){return r.data?.timeControl}}),b,p),n(U,()=>$()==="Black"?"Your Turn":"Waiting"),n(Se,()=>ue(Je())),n(Q,a(J,{get each(){return r.data?.capturedPieces?.white},children:t=>(()=>{var i=s(Qe);return Re(i,"title",`Captured ${t}`),n(i,()=>oe.White[t]),i})()}),ye,tt),n(Q,a(g,{get when(){return!r.data?.capturedPieces?.white?.length},get children(){return s(Oe)}}),rt,it),n(_e,a(g,{get when(){return I(()=>$()==="White")()&&(r.data?.moves?.length||0)>0||$()==="Black"&&w()},get children(){return[a(g,{get when(){return $()==="White"},get children(){var t=s(Xt);return t.$$click=()=>z.mutate(),_(()=>B(t,"disabled",z.isPending||(r.data?.moves?.length||0)===0)),j(),t}}),a(g,{get when(){return I(()=>$()==="Black")()&&w()},get children(){var t=s(Ke),i=t.firstChild,l=i.nextSibling;return i.$$click=me,n(i,a(g,{get when(){return k.isPending},get fallback(){return s(De)},get children(){return s(ze)}})),l.$$click=$e,_(o=>{var u=k.isPending,d=k.isPending;return u!==o.e&&B(i,"disabled",o.e=u),d!==o.t&&B(l,"disabled",o.t=d),o},{e:void 0,t:void 0}),j(),t}})]}}),ot,st),n(D,a(g,{get when(){return be()},get children(){var t=s(Vt),i=t.firstChild,l=i.nextSibling,o=l.nextSibling,[u,d]=c(o.nextSibling);return n(t,be,u,d),t}}),Ce,dt),n(D,a(g,{get when(){return fe()},get children(){var t=s(Zt),i=t.firstChild,l=i.nextSibling,o=l.nextSibling,[u,d]=c(o.nextSibling);return n(t,fe,u,d),t}}),ut,gt),n(X,a(J,{get each(){return Array.from({length:64})},children:(t,i)=>{const l=i(),o=Math.floor(l/8),u=l%8,d=(o+u)%2===1,C="bg-[#f0d9b5]",y="bg-[#b58863]",ee=()=>{const m=r.data?.lastMove;return m&&(m.from===l||m.to===l)};return(()=>{var m=s(on),te=m.firstChild,[A,ne]=c(te.nextSibling),re=A.nextSibling,[H,L]=c(re.nextSibling),Ft=H.nextSibling,[Fe,qt]=c(Ft.nextSibling),Nt=Fe.nextSibling,[qe,At]=c(Nt.nextSibling),It=qe.nextSibling,[Rt,Ot]=c(It.nextSibling);return m.$$click=()=>Xe(l),T(m,`relative w-full h-full flex items-center justify-center focus:outline-none transition-colors duration-200 ${d?y:C}`),n(m,a(g,{when:u===0,get children(){var h=s(Ge);return T(h,`absolute left-1 top-1 text-[10px] sm:text-xs font-black ${d?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),n(h,8-o),_(M=>F(h,"transform",`rotate(${R()===180?180:0}deg)`)),h}}),A,ne),n(m,a(g,{when:o===7,get children(){var h=s(Ge);return T(h,`absolute right-1 bottom-0.5 text-[10px] sm:text-xs font-black ${d?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),n(h,()=>String.fromCharCode(97+u)),_(M=>F(h,"transform",`rotate(${R()===180?180:0}deg)`)),h}}),H,L),n(m,a(g,{get when(){return ee()},get children(){return s(ln)}}),Fe,qt),n(m,a(g,{get when(){return xe().includes(l)},get children(){return!!he(l)?s(sn):s(an)}}),qe,At),n(m,()=>{const h=he(l);return a(g,{when:h,get children(){var M=s(dn);return n(M,()=>oe[h.color][h.piece_type]),_(P=>{var Ne=`rotate(${R()===180?180:0}deg)`,Ae=h.color==="White"?"#ffffff":"#1a1a1a",Ie=h.color==="White"?"0 2px 4px rgba(0,0,0,0.4)":"0 2px 4px rgba(255,255,255,0.1)";return Ne!==P.e&&F(M,"transform",P.e=Ne),Ae!==P.t&&F(M,"color",P.t=Ae),Ie!==P.a&&F(M,"text-shadow",P.a=Ie),P},{e:void 0,t:void 0,a:void 0}),M}})},Rt,Ot),_(h=>Qt(m,{"ring-inset ring-[6px] ring-indigo-500/60 z-10":K()===l,"hover:brightness-105":!K()||K()!==l},h)),j(),m})()}})),n(Me,a(g,{get when(){return I(()=>!!r.data?.status)()&&r.data?.status!=="Ongoing"},get children(){var t=s(en),i=t.firstChild,l=i.firstChild,o=l.nextSibling,u=o.nextSibling;return n(l,(()=>{var d=I(()=>r.data?.status==="Timeout");return()=>d()?"Time Out!":r.data?.status})()),n(o,()=>{const d=r.data?.status,C=r.data?.turn;if(d==="Stalemate")return"Draw";const y=C==="White"?"Black":"White";return d==="Timeout"?`${y} Wins by Time`:`${y} Wins`}),u.$$click=()=>ve(),j(),t}}),bt,ft),n(V,()=>$()==="White"?"Your Turn":"Waiting"),n(Te,()=>ue(Ye())),n(G,a(J,{get each(){return r.data?.capturedPieces?.black},children:t=>(()=>{var i=s(Qe);return Re(i,"title",`Captured ${t}`),n(i,()=>oe.Black[t]),i})()}),Ee,pt),n(G,a(g,{get when(){return!r.data?.capturedPieces?.black?.length},get children(){return s(Oe)}}),wt,St),n(Pe,a(g,{get when(){return $()==="Black"||$()==="White"&&w()},get children(){return[a(g,{get when(){return $()==="Black"},get children(){var t=s(tn);return t.$$click=()=>z.mutate(),_(()=>B(t,"disabled",z.isPending||(r.data?.moves?.length||0)===0)),j(),t}}),a(g,{get when(){return I(()=>$()==="White")()&&w()},get children(){var t=s(Ke),i=t.firstChild,l=i.nextSibling;return i.$$click=me,n(i,a(g,{get when(){return k.isPending},get fallback(){return s(De)},get children(){return s(ze)}})),l.$$click=$e,_(o=>{var u=k.isPending,d=k.isPending;return u!==o.e&&B(i,"disabled",o.e=u),d!==o.t&&B(l,"disabled",o.t=d),o},{e:void 0,t:void 0}),j(),t}})]}}),kt,Ct),n(Z,a(J,{get each(){return Array.from({length:Math.ceil((r.data?.moves?.length||0)/2)})},children:(t,i)=>{const l=i(),o=l*2,u=r.data?.moves?.[o],d=r.data?.moves?.[o+1];return(()=>{var C=s(un),y=C.firstChild,ee=y.firstChild,[m,te]=c(ee.nextSibling);m.nextSibling;var A=y.nextSibling,ne=A.nextSibling,[re,H]=c(ne.nextSibling);return n(y,l+1,m,te),n(A,()=>u?.notation),n(C,a(g,{when:d,get children(){var L=s(cn);return n(L,()=>d?.notation),L}}),re,H),C})()}}),Be,Et),n(Z,a(g,{get when(){return r.data?.moves?.length===0},get children(){return s(nn)}}),je,jt),_(t=>{var i=`text-xs font-bold uppercase tracking-wider ${$()==="Black"?"text-emerald-400":"text-stone-500"}`,l=`text-4xl font-mono font-bold mt-2 ${$()==="Black"?"text-white":"text-stone-600"}`,o=`rotate(${R()}deg)`,u=`text-xs font-bold uppercase tracking-wider ${$()==="White"?"text-emerald-400":"text-stone-500"}`,d=`text-4xl font-mono font-bold mt-2 ${$()==="White"?"text-white":"text-stone-600"}`;return i!==t.e&&T(U,t.e=i),l!==t.t&&T(Se,t.t=l),o!==t.a&&F(X,"transform",t.a=o),u!==t.o&&T(V,t.o=u),d!==t.i&&T(Te,t.i=d),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),e})()}Dt(["click"]);export{bn as component};
