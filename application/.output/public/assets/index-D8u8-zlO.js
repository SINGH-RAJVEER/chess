import{p as Ft,T as Me,a as Pt,i as Et,c as Q,u as At,b as N,d as Tt,e as le,f as je,h as Rt,g,j as b,k as c,l as w,s as Oe,F as D,S,m as oe,n as B,o as W,q as qt,r as K,v as Nt,w as Fe,t as m,x as Bt}from"./main-DDTxMDnH.js";function qe(t){if(Array.isArray(t))return t.flatMap(p=>qe(p));if(typeof t!="string")return[];const s=[];let e=0,l,d,r,n,a;const h=()=>{for(;e<t.length&&/\s/.test(t.charAt(e));)e+=1;return e<t.length},$=()=>(d=t.charAt(e),d!=="="&&d!==";"&&d!==",");for(;e<t.length;){for(l=e,a=!1;h();)if(d=t.charAt(e),d===","){for(r=e,e+=1,h(),n=e;e<t.length&&$();)e+=1;e<t.length&&t.charAt(e)==="="?(a=!0,e=n,s.push(t.slice(l,r)),l=e):e=r+1}else e+=1;(!a||e>=t.length)&&s.push(t.slice(l))}return s}function Wt(t){return t instanceof Headers?t:Array.isArray(t)?new Headers(t):typeof t=="object"?new Headers(t):null}function Ht(...t){return t.reduce((s,e)=>{const l=Wt(e);if(!l)return s;for(const[d,r]of l.entries())d==="set-cookie"?qe(r).forEach(a=>s.append("set-cookie",a)):s.set(d,r);return s},new Headers)}const Ne=()=>{throw new Error("createServerOnlyFn() functions can only be called on the server!")};function Pe(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function ce(t,s){const e=Object.create(null);if(t)for(const l of Object.keys(t))Pe(l)&&(e[l]=t[l]);if(s&&typeof s=="object")for(const l of Object.keys(s))Pe(l)&&(e[l]=s[l]);return e}function Be(t){return Object.create(null)}const T=(t,s)=>{const e=s||t||{};return typeof e.method>"u"&&(e.method="GET"),Object.assign(r=>{const n={...e,...r};return T(void 0,n)},{options:e,middleware:r=>{const n=[...e.middleware||[]];r.map($=>{Me in $?$.options.middleware&&n.push(...$.options.middleware):n.push($)});const a={...e,middleware:n},h=T(void 0,a);return h[Me]=!0,h},inputValidator:r=>{const n={...e,inputValidator:r};return T(void 0,n)},handler:(...r)=>{const[n,a]=r,h={...e,extractedFn:n,serverFn:a},$=[...h.middleware||[],Kt(h)];return Object.assign(async p=>{const f=await Ee($,"client",{...n,...h,data:p?.data,headers:p?.headers,signal:p?.signal,fetch:p?.fetch,context:Be()}),_=Ft(f.error);if(_)throw _;if(f.error)throw f.error;return f.result},{...n,__executeServer:async(p,f)=>{const _=Ne(),E=_.contextAfterGlobalMiddlewares,A={...n,...p,serverFnMeta:n.serverFnMeta,context:ce(E,p.context),signal:f,request:_.request};return await Ee($,"server",A).then(C=>({result:C.result,error:C.error,context:C.sendContext}))}})}})};async function Ee(t,s,e){const l=Pt()?.functionMiddleware||[];let d=Vt([...l,...t]);if(s==="server"){const n=Ne();n?.executedRequestMiddlewares&&(d=d.filter(a=>!n.executedRequestMiddlewares.has(a)))}const r=async n=>{const a=d.shift();if(!a)return n;try{"inputValidator"in a.options&&a.options.inputValidator&&s==="server"&&(n.data=await zt(a.options.inputValidator,n.data));let h;if(s==="client"?"client"in a.options&&(h=a.options.client):"server"in a.options&&(h=a.options.server),h){const p=await h({...n,next:async(f={})=>{const _={...n,...f,context:ce(n.context,f.context),sendContext:ce(n.sendContext,f.sendContext),headers:Ht(n.headers,f.headers),_callSiteFetch:n._callSiteFetch,fetch:n._callSiteFetch??f.fetch??n.fetch,result:f.result!==void 0?f.result:f instanceof Response?f:n.result,error:f.error??n.error},E=await r(_);if(E.error)throw E.error;return E}});if(Et(p))return{...n,error:p};if(p instanceof Response)return{...n,result:p};if(!p)throw new Error("User middleware returned undefined. You must call next() or return a result in your middlewares.");return p}return r(n)}catch(h){return{...n,error:h}}};return r({...e,headers:e.headers||{},sendContext:e.sendContext||{},context:e.context||Be(),_callSiteFetch:e.fetch})}function Vt(t,s=100){const e=new Set,l=[],d=(r,n)=>{if(n>s)throw new Error(`Middleware nesting depth exceeded maximum of ${s}. Check for circular references.`);r.forEach(a=>{a.options.middleware&&d(a.options.middleware,n+1),e.has(a)||(e.add(a),l.push(a))})};return d(t,0),l}async function zt(t,s){if(t==null)return{};if("~standard"in t){const e=await t["~standard"].validate(s);if(e.issues)throw new Error(JSON.stringify(e.issues,void 0,2));return e.value}if("parse"in t)return t.parse(s);if(typeof t=="function")return t(s);throw new Error("Invalid validator type!")}function Kt(t){return{"~types":void 0,options:{inputValidator:t.inputValidator,client:async({next:s,sendContext:e,fetch:l,...d})=>{const r={...d,context:e,fetch:l},n=await t.extractedFn?.(r);return s(n)},server:async({next:s,...e})=>{const l=await t.serverFn?.(e);return s({...e,result:l})}}}}const Qt=T({method:"POST"}).handler(Q("075bb97a5df53025c3a5cac3463aa1757848b60aac35966d56b3f5f04c96a880")),Gt=T({method:"POST"}).handler(Q("794ae25fdbad27267eddca374cd262923ce3a47f4b66b732f323ab20dcc22590")),Ut=T({method:"POST"}).handler(Q("7f22913cc8d51a01984f7bf48fae2f2d31d571b490a9d584529e84f9899ea385")),Yt=T({method:"POST"}).handler(Q("972086331ae1ccaf15884371b3d836c8b8cb9863f2467b06d69aa6f6555bec6c")),It=T({method:"POST"}).handler(Q("614b8f455b0bec4996eb16fc2e9a0377d9b5aca3671eb868a2af8c02e22f2c72"));var Ae=m('<span class="text-xs text-stone-300 italic self-center">No captures'),Lt=m('<div class="bg-red-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold animate-bounce flex items-center gap-2 border-4 border-white/20"><span>⚠️</span> <!$><!/>'),Jt=m('<div class="bg-emerald-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold flex items-center gap-2 border-4 border-white/20"><span>✨</span> <!$><!/>'),Xt=m('<div class="absolute inset-0 bg-stone-900/80 flex items-center justify-center z-50 backdrop-blur-md"><div class="bg-white p-12 rounded-3xl shadow-[0_0_100px_rgba(0,0,0,0.5)] text-center border-b-8 border-indigo-600 animate-in fade-in zoom-in duration-500"><h2 class="text-6xl font-black text-stone-900 mb-4 tracking-tighter">Checkmate</h2><p class="text-2xl font-bold text-indigo-600 mb-10 tracking-wide uppercase"></p><button class="px-10 py-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl font-black text-xl shadow-2xl transition-all transform hover:-translate-y-2 active:translate-y-0">New Challenge'),Zt=m('<button class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-indigo-200 transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2"><span>↺</span> Takeback'),Dt=m('<div class="flex gap-2 w-full mt-4"><button class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"><span>✓</span> Submit</button><button class="flex-1 bg-stone-400 hover:bg-stone-500 text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"><span>✕</span> Cancel'),en=m('<span class="text-stone-400 text-sm italic">Waiting for start...'),tn=m('<div class="min-h-screen bg-stone-100 font-sans text-stone-800 flex flex-col"><header class="bg-stone-900 text-white shadow-md px-6 py-3 sticky top-0 z-50 flex justify-between items-center"><div class="flex items-center gap-3"><span class=text-3xl>♛</span><h1 class="text-2xl font-black tracking-tighter uppercase">Chess<span class=text-indigo-500>Master</span></h1></div><nav class="hidden md:flex gap-8 font-bold text-sm text-stone-400 uppercase tracking-widest"><a href=# class="hover:text-white transition-colors">Play</a><a href=# class="hover:text-white transition-colors">Analysis</a><a href=# class="hover:text-white transition-colors">Settings</a></nav><div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center font-bold shadow-lg cursor-pointer hover:bg-indigo-500 transition">R</div></header><div class="flex-1 flex flex-col items-center justify-center p-4 lg:p-8 overflow-hidden relative"><div class="flex flex-col xl:flex-row items-center justify-center gap-8 w-full max-w-[1800px]"><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-2 xl:order-1"><div class="bg-white p-6 rounded-2xl shadow-xl border border-stone-200 flex flex-col gap-4 items-center text-center relative overflow-hidden group"><div class="absolute inset-0 bg-stone-800/5 opacity-0 group-hover:opacity-100 transition-opacity"></div><div class="w-20 h-20 bg-stone-800 rounded-2xl shadow-inner flex items-center justify-center text-stone-200 font-bold border-4 border-stone-600 text-3xl mb-2">B</div><div><div class="font-extrabold text-2xl leading-tight text-stone-900">Black</div><div class="text-xs text-stone-500 font-bold uppercase tracking-wider">Grandmaster</div></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-50 rounded-lg p-2 border border-stone-100"><!$><!/><!$><!/></div><button class="w-full mt-4 bg-stone-100 hover:bg-stone-200 text-stone-600 font-bold py-3 px-6 rounded-xl transition-all uppercase tracking-wider text-sm border-2 border-stone-200 hover:border-stone-300">Restart Game</button></div></div><div class="relative group order-1 xl:order-2"><div class="absolute -top-16 left-0 w-full flex justify-center h-12 pointer-events-none z-30"><!$><!/><!$><!/></div><div class="w-[80vw] h-[80vw] max-w-[800px] max-h-[800px] bg-stone-300 rounded-xl shadow-2xl overflow-hidden border-[16px] border-stone-800 relative select-none"><div class="grid grid-cols-8 grid-rows-[repeat(8,1fr)] w-full h-full transition-transform duration-1000 cubic-bezier(0.4, 0, 0.2, 1)"></div><!$><!/></div></div><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-3"><div class="bg-white p-6 rounded-2xl shadow-xl border-2 border-indigo-100 flex flex-col gap-4 items-center text-center relative overflow-hidden group ring-4 ring-indigo-500/10"><div class="absolute inset-0 bg-indigo-50/50 opacity-0 group-hover:opacity-100 transition-opacity"></div><div class="w-20 h-20 bg-white border-4 border-stone-200 rounded-2xl shadow-md flex items-center justify-center text-stone-900 font-bold text-3xl mb-2">W</div><div><div class="font-extrabold text-2xl leading-tight text-stone-900">White</div><div class="text-xs text-indigo-600 font-bold uppercase tracking-wider">Your Turn</div></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-50 rounded-lg p-2 border border-stone-100"><!$><!/><!$><!/></div><!$><!/><!$><!/></div></div></div></div><div class="bg-white border-t border-stone-200 p-2 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-40"><div class="max-w-[1800px] mx-auto flex items-center gap-4 overflow-x-auto scrollbar-thin scrollbar-thumb-stone-300 scrollbar-track-transparent px-4 pb-2"><div class="text-xs font-black text-stone-400 uppercase tracking-widest px-3 py-1 bg-stone-100 rounded-md shrink-0">History</div><div class="flex items-center gap-6 px-2 min-w-max"><!$><!/><!$><!/><div id=move-anchor class=w-2>'),Te=m('<span class="text-3xl filter drop-shadow-sm text-stone-800 hover:scale-125 transition-transform cursor-help">'),Re=m("<span>"),nn=m("<button><!$><!/><!$><!/><!$><!/><!$><!/>"),rn=m('<div class="absolute inset-0 border-[6px] sm:border-[8px] border-rose-500/50 rounded-full m-1 sm:m-2 pointer-events-none animate-pulse">'),sn=m('<div class="w-4 h-4 sm:w-6 sm:h-6 bg-stone-900/20 rounded-full pointer-events-none">'),ln=m('<span class="text-4xl sm:text-5xl md:text-7xl drop-shadow-2xl transition-all duration-700 ease-in-out cursor-pointer hover:scale-110 active:scale-90 transform-gpu z-20">'),on=m('<span class="font-bold text-stone-700 px-2 py-0.5 rounded hover:bg-stone-100 transition-colors cursor-pointer ml-1">'),an=m('<div class="flex items-center text-sm font-mono"><span class="text-stone-300 mr-2 select-none group-hover:text-stone-500 transition-colors"><!$><!/>.</span><span class="font-bold text-stone-700 px-2 py-0.5 rounded hover:bg-indigo-50 transition-colors cursor-pointer"></span><!$><!/>');const ae={White:{Pawn:"♙",Knight:"♘",Bishop:"♗",Rook:"♖",Queen:"♕",King:"♔"},Black:{Pawn:"♟",Knight:"♞",Bishop:"♝",Rook:"♜",Queen:"♛",King:"♚"}};function dn(){const t=At(),[s,e]=N(0),[l,d]=N(null),r=Tt(()=>({queryKey:["board"],queryFn:async()=>{try{return await Qt()}catch(i){throw console.error("✗ Failed to fetch board:",i),i}},staleTime:0,refetchOnWindowFocus:!0})),n=le(()=>({mutationFn:i=>Yt(i),onSuccess:async()=>{await t.invalidateQueries({queryKey:["board"]}),d(null)},onError:i=>{const k=i&&typeof i=="object"&&"message"in i?i.message:String(i);C(`Move failed: ${k}`),setTimeout(()=>C(null),3e3),d(null)}})),a=le(()=>({mutationFn:()=>Gt(),onSuccess:async()=>{await t.invalidateQueries({queryKey:["board"]}),ue("Takeback successful!"),setTimeout(()=>ue(null),2e3)},onError:i=>{C(`Undo failed: ${i.message}`),setTimeout(()=>C(null),3e3)}})),h=le(()=>({mutationFn:()=>It(),onSuccess:async()=>{await r.refetch(),_(null),A([]),d(null),C(null)},onError:i=>{C(`Failed to reset game: ${i instanceof Error?i.message:String(i)}`)}})),$=je(()=>{const i=r.data?.pieces||[],k=l();return k?i.filter(M=>M.square!==k.to).map(M=>M.square===k.from?{...M,square:k.to}:M):i}),p=je(()=>r.data?.turn||"White");Rt(()=>{p()==="Black"?e(180):e(0)});const[f,_]=N(null),[E,A]=N([]),[ee,C]=N(null),[de,ue]=N(null),fe=i=>$().find(k=>k.square===i),We=async i=>{if(!r.data||r.data.status!=="Ongoing"||l())return;const M=$().find(F=>F.square===i),H=f();if(M&&M.color===r.data.turn){if(H===i){_(null),A([]);return}_(i),C(null);try{const F=await Ut({data:i});A(Array.isArray(F)?F:[])}catch(F){console.error("✗ Failed to fetch moves:",F),C(`API Error: ${F?.message||"Unknown error"}`),A([])}return}H!==null&&(E().includes(i)?(d({from:H,to:i}),_(null),A([])):(_(null),A([])))},He=()=>{const i=l();i&&n.mutate({data:i})},Ve=()=>{d(null)},xe=()=>{h.mutate()};return(()=>{var i=g(tn),k=i.firstChild,M=k.nextSibling,H=M.firstChild,F=H.firstChild,ze=F.firstChild,Ke=ze.firstChild,Qe=Ke.nextSibling,Ge=Qe.nextSibling,G=Ge.nextSibling,Ue=G.firstChild,[he,Ye]=b(Ue.nextSibling),Ie=he.nextSibling,[Le,Je]=b(Ie.nextSibling),ge=G.nextSibling,be=F.nextSibling,U=be.firstChild,Xe=U.firstChild,[pe,Ze]=b(Xe.nextSibling),De=pe.nextSibling,[et,tt]=b(De.nextSibling),ve=U.nextSibling,te=ve.firstChild,nt=te.nextSibling,[rt,st]=b(nt.nextSibling),it=be.nextSibling,ne=it.firstChild,lt=ne.firstChild,ot=lt.nextSibling,at=ot.nextSibling,Y=at.nextSibling,ct=Y.firstChild,[we,dt]=b(ct.nextSibling),ut=we.nextSibling,[ft,xt]=b(ut.nextSibling),ht=Y.nextSibling,[me,gt]=b(ht.nextSibling),bt=me.nextSibling,[pt,vt]=b(bt.nextSibling),wt=M.nextSibling,mt=wt.firstChild,$t=mt.firstChild,re=$t.nextSibling,_t=re.firstChild,[$e,yt]=b(_t.nextSibling),St=$e.nextSibling,[_e,Ct]=b(St.nextSibling);return _e.nextSibling,c(G,w(D,{get each(){return r.data?.capturedPieces?.white},children:o=>(()=>{var u=g(Te);return Oe(u,"title",`Captured ${o}`),c(u,()=>ae.White[o]),u})()}),he,Ye),c(G,w(S,{get when(){return!r.data?.capturedPieces?.white?.length},get children(){return g(Ae)}}),Le,Je),ge.$$click=xe,c(U,w(S,{get when(){return ee()},get children(){var o=g(Lt),u=o.firstChild,x=u.nextSibling,y=x.nextSibling,[j,P]=b(y.nextSibling);return c(o,ee,j,P),o}}),pe,Ze),c(U,w(S,{get when(){return de()},get children(){var o=g(Jt),u=o.firstChild,x=u.nextSibling,y=x.nextSibling,[j,P]=b(y.nextSibling);return c(o,de,j,P),o}}),et,tt),c(te,w(D,{get each(){return Array.from({length:64})},children:(o,u)=>{const x=u(),y=Math.floor(x/8),j=x%8,P=(y+j)%2===1,V="bg-[#f0d9b5]",z="bg-[#b58863]";return(()=>{var O=g(nn),I=O.firstChild,[L,J]=b(I.nextSibling),se=L.nextSibling,[X,ie]=b(se.nextSibling),Z=X.nextSibling,[ye,kt]=b(Z.nextSibling),Mt=ye.nextSibling,[jt,Ot]=b(Mt.nextSibling);return O.$$click=()=>We(x),oe(O,`relative w-full h-full flex items-center justify-center focus:outline-none transition-colors duration-200 ${P?z:V}`),c(O,w(S,{when:j===0,get children(){var v=g(Re);return oe(v,`absolute left-1 top-1 text-[10px] sm:text-xs font-black ${P?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),c(v,8-y),B(R=>W(v,"transform",`rotate(${s()===180?180:0}deg)`)),v}}),L,J),c(O,w(S,{when:y===7,get children(){var v=g(Re);return oe(v,`absolute right-1 bottom-0.5 text-[10px] sm:text-xs font-black ${P?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),c(v,()=>String.fromCharCode(97+j)),B(R=>W(v,"transform",`rotate(${s()===180?180:0}deg)`)),v}}),X,ie),c(O,w(S,{get when(){return E().includes(x)},get children(){return!!fe(x)?g(rn):g(sn)}}),ye,kt),c(O,()=>{const v=fe(x);return w(S,{when:v,get children(){var R=g(ln);return c(R,()=>ae[v.color][v.piece_type]),B(q=>{var Se=`rotate(${s()===180?180:0}deg)`,Ce=v.color==="White"?"#ffffff":"#1a1a1a",ke=v.color==="White"?"0 2px 4px rgba(0,0,0,0.4)":"0 2px 4px rgba(255,255,255,0.1)";return Se!==q.e&&W(R,"transform",q.e=Se),Ce!==q.t&&W(R,"color",q.t=Ce),ke!==q.a&&W(R,"text-shadow",q.a=ke),q},{e:void 0,t:void 0,a:void 0}),R}})},jt,Ot),B(v=>qt(O,{"ring-inset ring-[6px] ring-indigo-500/60 z-10":f()===x,"hover:brightness-105":!f()||f()!==x},v)),K(),O})()}})),c(ve,w(S,{get when(){return Nt(()=>!!r.data?.status)()&&r.data?.status!=="Ongoing"},get children(){var o=g(Xt),u=o.firstChild,x=u.firstChild,y=x.nextSibling,j=y.nextSibling;return c(y,()=>r.data?.status),j.$$click=xe,K(),o}}),rt,st),c(Y,w(D,{get each(){return r.data?.capturedPieces?.black},children:o=>(()=>{var u=g(Te);return Oe(u,"title",`Captured ${o}`),c(u,()=>ae.Black[o]),u})()}),we,dt),c(Y,w(S,{get when(){return!r.data?.capturedPieces?.black?.length},get children(){return g(Ae)}}),ft,xt),c(ne,w(S,{get when(){return!l()},get children(){var o=g(Zt);return o.$$click=()=>a.mutate(),B(()=>Fe(o,"disabled",a.isPending||(r.data?.moves?.length||0)===0)),K(),o}}),me,gt),c(ne,w(S,{get when(){return l()},get children(){var o=g(Dt),u=o.firstChild,x=u.nextSibling;return u.$$click=He,x.$$click=Ve,K(),o}}),pt,vt),c(re,w(D,{get each(){return Array.from({length:Math.ceil((r.data?.moves?.length||0)/2)})},children:(o,u)=>{const x=u(),y=x*2,j=r.data?.moves?.[y],P=r.data?.moves?.[y+1];return(()=>{var V=g(an),z=V.firstChild,O=z.firstChild,[I,L]=b(O.nextSibling);I.nextSibling;var J=z.nextSibling,se=J.nextSibling,[X,ie]=b(se.nextSibling);return c(z,x+1,I,L),c(J,()=>j?.notation),c(V,w(S,{when:P,get children(){var Z=g(on);return c(Z,()=>P?.notation),Z}}),X,ie),V})()}}),$e,yt),c(re,w(S,{get when(){return r.data?.moves?.length===0},get children(){return g(en)}}),_e,Ct),B(o=>{var u=h.isPending,x=`rotate(${s()}deg)`;return u!==o.e&&Fe(ge,"disabled",o.e=u),x!==o.t&&W(te,"transform",o.t=x),o},{e:void 0,t:void 0}),K(),i})()}Bt(["click"]);export{dn as component};
