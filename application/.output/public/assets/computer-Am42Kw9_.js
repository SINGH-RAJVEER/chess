import{u as Tt,c as w,a as L,b as Et,d as J,e as O,g as s,f as c,i as n,h as u,j as C,k as S,S as b,s as Se,F as U,l as ye,m as Wt,r as R,n as X,o as V,t as x,p as jt}from"./main-DW29Nr_m.js";import{H as At,g as Bt,r as Ft,a as Nt,m as qt,u as Ot}from"./header-Dp3a2eRy.js";var ke=x("<div>"),Ce=x('<span class="text-xs text-stone-600 italic self-center">No captures'),Rt=x('<div class="bg-red-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold animate-bounce flex items-center gap-2 border-4 border-stone-900"><span>‚ö†Ô∏è</span> <!$><!/>'),Kt=x('<div class="bg-emerald-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold flex items-center gap-2 border-4 border-stone-900"><span>‚ú®</span> <!$><!/>'),Qt=x('<div class="absolute inset-0 bg-stone-900/80 flex items-center justify-center z-50 backdrop-blur-md"><div class="bg-stone-800 p-12 rounded-3xl shadow-[0_0_100px_rgba(0,0,0,0.5)] text-center border-b-8 border-indigo-600 animate-in fade-in zoom-in duration-500"><h2 class="text-6xl font-black text-stone-100 mb-4 tracking-tighter"></h2><p class="text-2xl font-bold text-indigo-400 mb-10 tracking-wide uppercase"></p><button class="px-10 py-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl font-black text-xl shadow-2xl transition-all transform hover:-translate-y-2 active:translate-y-0">New Challenge'),It=x("<span>..."),zt=x('<div class="flex gap-2 w-full"><button class="flex-1 bg-emerald-600 hover:bg-emerald-500 disabled:bg-emerald-800 disabled:cursor-not-allowed text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"></button><button class="flex-1 bg-stone-600 hover:bg-stone-500 disabled:opacity-50 text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"><span>‚úï</span> Cancel'),Gt=x('<div class="min-h-screen bg-gradient-to-br from-stone-900 via-stone-900 to-black font-sans text-stone-200 flex flex-col"><!$><!/><div class="flex-1 flex flex-col items-center justify-center p-4 lg:p-8 overflow-hidden relative"><div class="flex flex-col xl:flex-row items-center justify-center gap-8 w-full max-w-[1800px]"><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-2 xl:order-1"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-stone-950 rounded-2xl shadow-inner flex items-center justify-center text-stone-200 font-bold border-4 border-stone-700 text-5xl mb-2">ü§ñ</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">Engine</div><div></div><!$><!/></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div></div></div><div class="relative group order-1 xl:order-2"><div class="absolute -top-16 left-0 w-full flex justify-center h-12 pointer-events-none z-30"><!$><!/><!$><!/></div><div class="w-[80vw] h-[80vw] max-w-[800px] max-h-[800px] bg-stone-700 rounded-xl shadow-2xl overflow-hidden border-[16px] border-stone-950 relative select-none"><div class="grid grid-cols-8 grid-rows-[repeat(8,1fr)] w-full h-full"></div><!$><!/></div></div><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-3"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-stone-200 border-4 border-stone-500 rounded-2xl shadow-md flex items-center justify-center text-stone-900 font-bold text-3xl mb-2">W</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">You</div><div></div><!$><!/></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div><div class="w-full flex flex-col gap-2 mt-2"><button class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2"><span>‚Ü∫</span> Takeback</button><!$><!/>'),Me=x('<span class="text-3xl filter drop-shadow-sm text-stone-400">'),Pe=x("<span>"),Yt=x('<div class="absolute inset-0 bg-yellow-500/60 pointer-events-none mix-blend-hard-light">'),Dt=x("<button><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Ht=x('<div class="absolute inset-0 border-[6px] sm:border-[8px] border-rose-500/50 rounded-full m-1 sm:m-2 pointer-events-none animate-pulse">'),Lt=x('<div class="w-4 h-4 sm:w-6 sm:h-6 bg-stone-900/40 rounded-full pointer-events-none">'),Jt=x('<span class="text-4xl sm:text-5xl md:text-7xl drop-shadow-2xl transition-all duration-700 ease-in-out cursor-pointer hover:scale-110 active:scale-90 transform-gpu z-20">'),Ut=x("<span>‚úì Submit");const Z={White:{Pawn:"‚ôô",Knight:"‚ôò",Bishop:"‚ôó",Rook:"‚ôñ",Queen:"‚ôï",King:"‚ôî"},Black:{Pawn:"‚ôü",Knight:"‚ôû",Bishop:"‚ôù",Rook:"‚ôú",Queen:"‚ôõ",King:"‚ôö"}};function nn(){const ee=Tt(),[Xt,Vt]=w(0),Te=()=>{if(typeof window<"u")try{const e=localStorage.getItem("chess_pending_move_comp");return e?JSON.parse(e):null}catch(e){console.error("Failed to parse pending move",e)}return null},[M,W]=w(Te());L(()=>{if(typeof window<"u"){const e=M();e?localStorage.setItem("chess_pending_move_comp",JSON.stringify(e)):localStorage.removeItem("chess_pending_move_comp")}});const r=Et(()=>({queryKey:["board"],queryFn:async()=>{try{return await Bt()}catch(e){throw console.error("‚úó Failed to fetch board:",e),e}},staleTime:0,refetchOnWindowFocus:!0,refetchInterval:e=>{const l=e.state.data;return l&&l.mode==="vs_computer"&&l.turn==="Black"&&l.status==="Ongoing"?1e3:!1}}));L(()=>{r.data&&r.data.mode!=="vs_computer"&&K({mode:"vs_computer",timeControl:0})});const j=J(()=>({mutationFn:e=>qt(e),onSuccess:async()=>{await ee.invalidateQueries({queryKey:["board"]}),W(null)},onError:e=>{const l=e&&typeof e=="object"&&"message"in e?e.message:String(e);_(`Move failed: ${l}`),setTimeout(()=>_(null),3e3)}})),y=J(()=>({mutationFn:()=>Ot(),onSuccess:async()=>{await ee.invalidateQueries({queryKey:["board"]})},onError:e=>{_(`Undo failed: ${e.message}`),setTimeout(()=>_(null),3e3)}})),te=J(()=>({mutationFn:e=>Ft({data:e}),onSuccess:async()=>{await r.refetch(),P(null),k([]),W(null),_(null)},onError:e=>{_(`Failed to reset game: ${e instanceof Error?e.message:String(e)}`)}})),[ne,Ee]=w(Date.now());L(()=>{const e=setInterval(()=>{Ee(Date.now())},100);return()=>clearInterval(e)});const re=e=>{if(r.data?.timeControl===0)return"‚àû";const l=Math.max(0,Math.floor(e/1e3)),a=Math.floor(l/60),h=l%60;return`${a}:${h.toString().padStart(2,"0")}`},We=O(()=>{if(!r.data)return 0;const{turn:e,status:l,whiteTimeRemaining:a,lastMoveTime:h,timeControl:$}=r.data;if($===0)return Number.MAX_SAFE_INTEGER;if(e==="White"&&l==="Ongoing"&&h){const T=ne()-h;return Math.max(0,a-T)}return a}),je=O(()=>{if(!r.data)return 0;const{turn:e,status:l,blackTimeRemaining:a,lastMoveTime:h,timeControl:$}=r.data;if($===0)return Number.MAX_SAFE_INTEGER;if(e==="Black"&&l==="Ongoing"&&h){const T=ne()-h;return Math.max(0,a-T)}return a}),le=O(()=>{const e=r.data?.pieces||[],l=M();return l?e.filter(a=>a.square!==l.to).map(a=>a.square===l.from?{...a,square:l.to}:a):e}),p=O(()=>r.data?.turn||"White"),[A,P]=w(null),[ie,k]=w([]),[oe,_]=w(null),[se,Zt]=w(null),ae=e=>le().find(l=>l.square===e),Ae=async e=>{if(!r.data||r.data.status!=="Ongoing"||p()!=="White"||M())return;const a=le().find($=>$.square===e),h=A();if(a&&a.color==="White"){if(h===e){P(null),k([]);return}P(e),_(null);try{const $=await Nt({data:e});k(Array.isArray($)?$:[])}catch($){_(`API Error: ${$?.message||"Unknown error"}`),k([])}return}h!==null&&(ie().includes(e)?(W({from:h,to:e}),P(null),k([])):(P(null),k([])))},Be=()=>{const e=M();e&&j.mutate({data:e})},Fe=()=>{W(null)},Ne=async()=>{if(!y.isPending)try{p()==="White"?(r.data?.moves?.length||0)>=2?(await y.mutateAsync(),await y.mutateAsync()):(r.data?.moves?.length||0)===1&&await y.mutateAsync():(r.data?.moves?.length||0)>=1&&await y.mutateAsync()}catch(e){console.error("Takeback failed",e)}},K=e=>{const l=e?.mode==="vs_computer"?{...e,timeControl:0}:e||{mode:"vs_computer",timeControl:0};te.mutate(l)};return(()=>{var e=s(Gt),l=e.firstChild,[a,h]=c(l.nextSibling),$=a.nextSibling,T=$.firstChild,de=T.firstChild,qe=de.firstChild,Oe=qe.firstChild,Q=Oe.nextSibling,Re=Q.firstChild,I=Re.nextSibling,Ke=I.nextSibling,[Qe,Ie]=c(Ke.nextSibling),z=Q.nextSibling,ze=z.firstChild,[ce,Ge]=c(ze.nextSibling),Ye=ce.nextSibling,[De,He]=c(Ye.nextSibling),ue=de.nextSibling,B=ue.firstChild,Le=B.firstChild,[ge,Je]=c(Le.nextSibling),Ue=ge.nextSibling,[Xe,Ve]=c(Ue.nextSibling),xe=B.nextSibling,fe=xe.firstChild,Ze=fe.nextSibling,[et,tt]=c(Ze.nextSibling),nt=ue.nextSibling,rt=nt.firstChild,lt=rt.firstChild,G=lt.nextSibling,it=G.firstChild,Y=it.nextSibling,ot=Y.nextSibling,[st,at]=c(ot.nextSibling),F=G.nextSibling,dt=F.firstChild,[me,ct]=c(dt.nextSibling),ut=me.nextSibling,[gt,xt]=c(ut.nextSibling),be=F.nextSibling,D=be.firstChild,ft=D.nextSibling,[mt,bt]=c(ft.nextSibling);return n(e,u(At,{onRestart:K,get isRestarting(){return te.isPending},activeMode:"vs_computer",get currentTimeControl(){return r.data?.timeControl}}),a,h),n(I,()=>p()==="Black"?"Thinking...":"Waiting"),n(Q,u(b,{get when(){return r.data?.timeControl!==0},get children(){var t=s(ke);return n(t,()=>re(je())),C(()=>S(t,`text-4xl font-mono font-bold mt-2 ${p()==="Black"?"text-white":"text-stone-600"}`)),t}}),Qe,Ie),n(z,u(U,{get each(){return r.data?.capturedPieces?.white},children:t=>(()=>{var i=s(Me);return Se(i,"title",`Captured ${t}`),n(i,()=>Z.White[t]),i})()}),ce,Ge),n(z,u(b,{get when(){return!r.data?.capturedPieces?.white?.length},get children(){return s(Ce)}}),De,He),n(B,u(b,{get when(){return oe()},get children(){var t=s(Rt),i=t.firstChild,o=i.nextSibling,d=o.nextSibling,[v,f]=c(d.nextSibling);return n(t,oe,v,f),t}}),ge,Je),n(B,u(b,{get when(){return se()},get children(){var t=s(Kt),i=t.firstChild,o=i.nextSibling,d=o.nextSibling,[v,f]=c(d.nextSibling);return n(t,se,v,f),t}}),Xe,Ve),n(fe,u(U,{get each(){return Array.from({length:64})},children:(t,i)=>{const o=i(),d=Math.floor(o/8),v=o%8,f=(d+v)%2===1,H="bg-[#f0d9b5]",N="bg-[#b58863]",ht=()=>{const m=r.data?.lastMove;return m&&(m.from===o||m.to===o)};return(()=>{var m=s(Dt),$t=m.firstChild,[he,vt]=c($t.nextSibling),pt=he.nextSibling,[$e,_t]=c(pt.nextSibling),wt=$e.nextSibling,[ve,St]=c(wt.nextSibling),yt=ve.nextSibling,[pe,kt]=c(yt.nextSibling),Ct=pe.nextSibling,[Mt,Pt]=c(Ct.nextSibling);return m.$$click=()=>Ae(o),S(m,`relative w-full h-full flex items-center justify-center focus:outline-none transition-colors duration-200 ${f?N:H}`),n(m,u(b,{when:v===0,get children(){var g=s(Pe);return S(g,`absolute left-1 top-1 text-[10px] sm:text-xs font-black ${f?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),n(g,8-d),g}}),he,vt),n(m,u(b,{when:d===7,get children(){var g=s(Pe);return S(g,`absolute right-1 bottom-0.5 text-[10px] sm:text-xs font-black ${f?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),n(g,()=>String.fromCharCode(97+v)),g}}),$e,_t),n(m,u(b,{get when(){return ht()},get children(){return s(Yt)}}),ve,St),n(m,u(b,{get when(){return ie().includes(o)},get children(){return!!ae(o)?s(Ht):s(Lt)}}),pe,kt),n(m,()=>{const g=ae(o);return u(b,{when:g,get children(){var q=s(Jt);return n(q,()=>Z[g.color][g.piece_type]),C(E=>{var _e=g.color==="White"?"#ffffff":"#1a1a1a",we=g.color==="White"?"0 2px 4px rgba(0,0,0,0.4)":"0 2px 4px rgba(255,255,255,0.1)";return _e!==E.e&&ye(q,"color",E.e=_e),we!==E.t&&ye(q,"text-shadow",E.t=we),E},{e:void 0,t:void 0}),q}})},Mt,Pt),C(g=>Wt(m,{"ring-inset ring-[6px] ring-indigo-500/60 z-10":A()===o,"hover:brightness-105":!A()||A()!==o},g)),R(),m})()}})),n(xe,u(b,{get when(){return X(()=>!!r.data?.status)()&&r.data?.status!=="Ongoing"},get children(){var t=s(Qt),i=t.firstChild,o=i.firstChild,d=o.nextSibling,v=d.nextSibling;return n(o,(()=>{var f=X(()=>r.data?.status==="Timeout");return()=>f()?"Time Out!":r.data?.status})()),n(d,()=>{const f=r.data?.status,H=r.data?.turn;if(f==="Stalemate")return"Draw";const N=H==="White"?"Engine":"You";return f==="Timeout"?`${N} Wins by Time`:`${N} Wins`}),v.$$click=()=>K(),R(),t}}),et,tt),n(Y,()=>p()==="White"?"Your Turn":"Waiting"),n(G,u(b,{get when(){return r.data?.timeControl!==0},get children(){var t=s(ke);return n(t,()=>re(We())),C(()=>S(t,`text-4xl font-mono font-bold mt-2 ${p()==="White"?"text-white":"text-stone-600"}`)),t}}),st,at),n(F,u(U,{get each(){return r.data?.capturedPieces?.black},children:t=>(()=>{var i=s(Me);return Se(i,"title",`Captured ${t}`),n(i,()=>Z.Black[t]),i})()}),me,ct),n(F,u(b,{get when(){return!r.data?.capturedPieces?.black?.length},get children(){return s(Ce)}}),gt,xt),D.$$click=Ne,n(be,u(b,{get when(){return X(()=>p()==="White")()&&M()},get children(){var t=s(zt),i=t.firstChild,o=i.nextSibling;return i.$$click=Be,n(i,u(b,{get when(){return j.isPending},get fallback(){return s(Ut)},get children(){return s(It)}})),o.$$click=Fe,C(d=>{var v=j.isPending,f=j.isPending;return v!==d.e&&V(i,"disabled",d.e=v),f!==d.t&&V(o,"disabled",d.t=f),d},{e:void 0,t:void 0}),R(),t}}),mt,bt),C(t=>{var i=`text-xs font-bold uppercase tracking-wider ${p()==="Black"?"text-emerald-400":"text-stone-500"}`,o=`text-xs font-bold uppercase tracking-wider ${p()==="White"?"text-emerald-400":"text-stone-500"}`,d=y.isPending||(r.data?.moves?.length||0)===0;return i!==t.e&&S(I,t.e=i),o!==t.t&&S(Y,t.t=o),d!==t.a&&V(D,"disabled",t.a=d),t},{e:void 0,t:void 0,a:void 0}),R(),e})()}jt(["click"]);export{nn as component};
