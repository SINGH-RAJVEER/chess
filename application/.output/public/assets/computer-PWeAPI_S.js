import{u as Wt,c as w,a as L,b as jt,d as J,e as I,g as a,f as d,i as r,h as c,j as S,k as y,S as m,s as Se,F as U,l as ye,m as At,r as O,n as X,o as V,t as u,p as qt}from"./main-CXeWjMn0.js";import{H as Bt,g as Ft,r as Nt,a as It,u as Ot,m as Rt}from"./header-Q6tATL8l.js";var ke=u("<div>"),Ce=u('<span class="text-xs text-stone-600 italic self-center">No captures'),Kt=u('<div class="bg-red-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold animate-bounce flex items-center gap-2 border-4 border-stone-900"><span>‚ö†Ô∏è</span> <!$><!/>'),Qt=u('<div class="bg-emerald-600 text-white px-8 py-3 rounded-full shadow-2xl text-base font-bold flex items-center gap-2 border-4 border-stone-900"><span>‚ú®</span> <!$><!/>'),Gt=u('<div class="absolute inset-0 bg-stone-900/80 flex items-center justify-center z-50 backdrop-blur-md"><div class="bg-stone-800 p-12 rounded-3xl shadow-[0_0_100px_rgba(0,0,0,0.5)] text-center border-b-8 border-indigo-600 animate-in fade-in zoom-in duration-500"><h2 class="text-6xl font-black text-stone-100 mb-4 tracking-tighter"></h2><p class="text-2xl font-bold text-indigo-400 mb-10 tracking-wide uppercase"></p><button class="px-10 py-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl font-black text-xl shadow-2xl transition-all transform hover:-translate-y-2 active:translate-y-0">New Challenge'),zt=u('<button class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2"><span>‚Ü∫</span> Takeback'),Dt=u("<span>..."),Yt=u('<div class="flex gap-2 w-full"><button class="flex-1 bg-emerald-600 hover:bg-emerald-500 disabled:bg-emerald-800 disabled:cursor-not-allowed text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"></button><button class="flex-1 bg-stone-600 hover:bg-stone-500 disabled:opacity-50 text-white font-bold py-3 px-2 rounded-xl shadow-lg transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-1"><span>‚úï</span> Cancel'),Ht=u('<div class="min-h-screen bg-gradient-to-br from-stone-900 via-stone-900 to-black font-sans text-stone-200 flex flex-col"><!$><!/><div class="flex-1 flex flex-col items-center justify-center p-4 lg:p-8 overflow-hidden relative"><div class="flex flex-col xl:flex-row items-center justify-center gap-8 w-full max-w-[1800px]"><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-2 xl:order-1"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-stone-950 rounded-2xl shadow-inner flex items-center justify-center text-stone-200 font-bold border-4 border-stone-700 text-5xl mb-2">ü§ñ</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">Engine</div><div></div><!$><!/></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div></div></div><div class="relative group order-1 xl:order-2"><div class="absolute -top-16 left-0 w-full flex justify-center h-12 pointer-events-none z-30"><!$><!/><!$><!/></div><div class="w-[80vw] h-[80vw] max-w-[800px] max-h-[800px] bg-stone-700 rounded-xl shadow-2xl overflow-hidden border-[16px] border-stone-950 relative select-none"><div class="grid grid-cols-8 grid-rows-[repeat(8,1fr)] w-full h-full"></div><!$><!/></div></div><div class="flex flex-col gap-6 w-full max-w-[300px] xl:h-[800px] xl:justify-center order-3"><div class="bg-stone-800 p-6 rounded-2xl shadow-xl border border-stone-700 flex flex-col gap-4 items-center text-center relative overflow-hidden"><div class="w-20 h-20 bg-stone-200 border-4 border-stone-500 rounded-2xl shadow-md flex items-center justify-center text-stone-900 font-bold text-3xl mb-2">W</div><div><div class="font-extrabold text-2xl leading-tight text-stone-100">You</div><div></div><!$><!/></div><div class="flex flex-wrap justify-center gap-1 min-h-[40px] w-full bg-stone-900/50 rounded-lg p-2 border border-stone-700"><!$><!/><!$><!/></div><div class="w-full flex flex-col gap-2 mt-2"><!$><!/><!$><!/>'),Me=u('<span class="text-3xl filter drop-shadow-sm text-stone-400">'),Pe=u("<span>"),Lt=u('<div class="absolute inset-0 bg-yellow-500/60 pointer-events-none mix-blend-hard-light">'),Jt=u("<button><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Ut=u('<div class="absolute inset-0 border-[6px] sm:border-[8px] border-rose-500/50 rounded-full m-1 sm:m-2 pointer-events-none animate-pulse">'),Xt=u('<div class="w-4 h-4 sm:w-6 sm:h-6 bg-stone-900/40 rounded-full pointer-events-none">'),Vt=u('<span class="text-4xl sm:text-5xl md:text-7xl drop-shadow-2xl transition-all duration-700 ease-in-out cursor-pointer hover:scale-110 active:scale-90 transform-gpu z-20">'),Zt=u("<span>‚úì Submit");const Z={White:{Pawn:"‚ôô",Knight:"‚ôò",Bishop:"‚ôó",Rook:"‚ôñ",Queen:"‚ôï",King:"‚ôî"},Black:{Pawn:"‚ôü",Knight:"‚ôû",Bishop:"‚ôù",Rook:"‚ôú",Queen:"‚ôõ",King:"‚ôö"}};function on(){const ee=Wt(),[en,tn]=w(0),Ee=()=>{if(typeof window<"u")try{const e=localStorage.getItem("chess_pending_move_comp");return e?JSON.parse(e):null}catch(e){console.error("Failed to parse pending move",e)}return null},[k,W]=w(Ee());L(()=>{if(typeof window<"u"){const e=k();e?localStorage.setItem("chess_pending_move_comp",JSON.stringify(e)):localStorage.removeItem("chess_pending_move_comp")}});const n=jt(()=>({queryKey:["board"],queryFn:async()=>{try{return await Ft({data:{mode:"vs_computer"}})}catch(e){throw console.error("‚úó Failed to fetch board:",e),e}},staleTime:0,refetchOnWindowFocus:!0,refetchInterval:e=>{const l=e.state.data;return l&&l.mode==="vs_computer"&&l.turn==="Black"&&l.status==="Ongoing"?1e3:!1}}));L(()=>{n.data&&n.data.mode!=="vs_computer"&&R({mode:"vs_computer",timeControl:0})});const j=J(()=>({mutationFn:e=>{if(!n.data?.id)throw new Error("Game ID not found");return Rt({data:{...e.data,gameId:n.data.id}})},onSuccess:async()=>{await ee.invalidateQueries({queryKey:["board"]}),W(null)},onError:e=>{const l=e&&typeof e=="object"&&"message"in e?e.message:String(e);_(`Move failed: ${l}`),setTimeout(()=>_(null),3e3)}})),C=J(()=>({mutationFn:()=>{if(!n.data?.id)throw new Error("Game ID not found");return Ot({data:{gameId:n.data.id}})},onSuccess:async()=>{await ee.invalidateQueries({queryKey:["board"]})},onError:e=>{_(`Undo failed: ${e.message}`),setTimeout(()=>_(null),3e3)}})),te=J(()=>({mutationFn:e=>Nt({data:e}),onSuccess:async()=>{await n.refetch(),P(null),M([]),W(null),_(null)},onError:e=>{_(`Failed to reset game: ${e instanceof Error?e.message:String(e)}`)}})),[ne,Te]=w(Date.now());L(()=>{const e=setInterval(()=>{Te(Date.now())},100);return()=>clearInterval(e)});const re=e=>{if(n.data?.timeControl===0)return"‚àû";const l=Math.max(0,Math.floor(e/1e3)),s=Math.floor(l/60),h=l%60;return`${s}:${h.toString().padStart(2,"0")}`},We=I(()=>{if(!n.data)return 0;const{turn:e,status:l,whiteTimeRemaining:s,lastMoveTime:h,timeControl:$}=n.data;if($===0)return Number.MAX_SAFE_INTEGER;if(e==="White"&&l==="Ongoing"&&h){const E=ne()-h;return Math.max(0,s-E)}return s}),je=I(()=>{if(!n.data)return 0;const{turn:e,status:l,blackTimeRemaining:s,lastMoveTime:h,timeControl:$}=n.data;if($===0)return Number.MAX_SAFE_INTEGER;if(e==="Black"&&l==="Ongoing"&&h){const E=ne()-h;return Math.max(0,s-E)}return s}),le=I(()=>{const e=n.data?.pieces||[],l=k();return l?e.filter(s=>s.square!==l.to).map(s=>s.square===l.from?{...s,square:l.to}:s):e}),v=I(()=>n.data?.turn||"White"),[A,P]=w(null),[ie,M]=w([]),[oe,_]=w(null),[ae,nn]=w(null),se=e=>le().find(l=>l.square===e),Ae=async e=>{if(!n.data||n.data.status!=="Ongoing"||v()!=="White"||k())return;const s=le().find($=>$.square===e),h=A();if(s&&s.color==="White"){if(h===e){P(null),M([]);return}P(e),_(null);try{if(!n.data?.id)return;const $=await It({data:{square:e,gameId:n.data.id}});M(Array.isArray($)?$:[])}catch($){_(`API Error: ${$?.message||"Unknown error"}`),M([])}return}h!==null&&(ie().includes(e)?(W({from:h,to:e}),P(null),M([])):(P(null),M([])))},qe=()=>{const e=k();e&&j.mutate({data:e})},Be=()=>{W(null)},Fe=async()=>{if(!C.isPending)try{v()==="White"?(n.data?.moves?.length||0)>=2?(await C.mutateAsync(),await C.mutateAsync()):(n.data?.moves?.length||0)===1&&await C.mutateAsync():(n.data?.moves?.length||0)>=1&&await C.mutateAsync()}catch(e){console.error("Takeback failed",e)}},R=e=>{const l=e?.mode==="vs_computer"?{...e,timeControl:0}:e||{mode:"vs_computer",timeControl:0};te.mutate(l)};return(()=>{var e=a(Ht),l=e.firstChild,[s,h]=d(l.nextSibling),$=s.nextSibling,E=$.firstChild,de=E.firstChild,Ne=de.firstChild,Ie=Ne.firstChild,K=Ie.nextSibling,Oe=K.firstChild,Q=Oe.nextSibling,Re=Q.nextSibling,[Ke,Qe]=d(Re.nextSibling),G=K.nextSibling,Ge=G.firstChild,[ce,ze]=d(Ge.nextSibling),De=ce.nextSibling,[Ye,He]=d(De.nextSibling),ue=de.nextSibling,q=ue.firstChild,Le=q.firstChild,[ge,Je]=d(Le.nextSibling),Ue=ge.nextSibling,[Xe,Ve]=d(Ue.nextSibling),xe=q.nextSibling,fe=xe.firstChild,Ze=fe.nextSibling,[et,tt]=d(Ze.nextSibling),nt=ue.nextSibling,rt=nt.firstChild,lt=rt.firstChild,z=lt.nextSibling,it=z.firstChild,D=it.nextSibling,ot=D.nextSibling,[at,st]=d(ot.nextSibling),B=z.nextSibling,dt=B.firstChild,[me,ct]=d(dt.nextSibling),ut=me.nextSibling,[gt,xt]=d(ut.nextSibling),Y=B.nextSibling,ft=Y.firstChild,[be,mt]=d(ft.nextSibling),bt=be.nextSibling,[ht,$t]=d(bt.nextSibling);return r(e,c(Bt,{onRestart:R,get isRestarting(){return te.isPending},activeMode:"vs_computer",get currentTimeControl(){return n.data?.timeControl}}),s,h),r(Q,()=>v()==="Black"?"Thinking...":"Waiting"),r(K,c(m,{get when(){return n.data?.timeControl!==0},get children(){var t=a(ke);return r(t,()=>re(je())),S(()=>y(t,`text-4xl font-mono font-bold mt-2 ${v()==="Black"?"text-white":"text-stone-600"}`)),t}}),Ke,Qe),r(G,c(U,{get each(){return n.data?.capturedPieces?.white},children:t=>(()=>{var i=a(Me);return Se(i,"title",`Captured ${t}`),r(i,()=>Z.White[t]),i})()}),ce,ze),r(G,c(m,{get when(){return!n.data?.capturedPieces?.white?.length},get children(){return a(Ce)}}),Ye,He),r(q,c(m,{get when(){return oe()},get children(){var t=a(Kt),i=t.firstChild,o=i.nextSibling,g=o.nextSibling,[p,f]=d(g.nextSibling);return r(t,oe,p,f),t}}),ge,Je),r(q,c(m,{get when(){return ae()},get children(){var t=a(Qt),i=t.firstChild,o=i.nextSibling,g=o.nextSibling,[p,f]=d(g.nextSibling);return r(t,ae,p,f),t}}),Xe,Ve),r(fe,c(U,{get each(){return Array.from({length:64})},children:(t,i)=>{const o=i(),g=Math.floor(o/8),p=o%8,f=(g+p)%2===1,H="bg-[#f0d9b5]",F="bg-[#b58863]",pt=()=>{const b=n.data?.lastMove;return b&&(b.from===o||b.to===o)};return(()=>{var b=a(Jt),vt=b.firstChild,[he,_t]=d(vt.nextSibling),wt=he.nextSibling,[$e,St]=d(wt.nextSibling),yt=$e.nextSibling,[pe,kt]=d(yt.nextSibling),Ct=pe.nextSibling,[ve,Mt]=d(Ct.nextSibling),Pt=ve.nextSibling,[Et,Tt]=d(Pt.nextSibling);return b.$$click=()=>Ae(o),y(b,`relative w-full h-full flex items-center justify-center focus:outline-none transition-colors duration-200 ${f?F:H}`),r(b,c(m,{when:p===0,get children(){var x=a(Pe);return y(x,`absolute left-1 top-1 text-[10px] sm:text-xs font-black ${f?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),r(x,8-g),x}}),he,_t),r(b,c(m,{when:g===7,get children(){var x=a(Pe);return y(x,`absolute right-1 bottom-0.5 text-[10px] sm:text-xs font-black ${f?"text-[#f0d9b5]":"text-[#b58863]"} opacity-60`),r(x,()=>String.fromCharCode(97+p)),x}}),$e,St),r(b,c(m,{get when(){return pt()},get children(){return a(Lt)}}),pe,kt),r(b,c(m,{get when(){return ie().includes(o)},get children(){return!!se(o)?a(Ut):a(Xt)}}),ve,Mt),r(b,()=>{const x=se(o);return c(m,{when:x,get children(){var N=a(Vt);return r(N,()=>Z[x.color][x.piece_type]),S(T=>{var _e=x.color==="White"?"#ffffff":"#1a1a1a",we=x.color==="White"?"0 2px 4px rgba(0,0,0,0.4)":"0 2px 4px rgba(255,255,255,0.1)";return _e!==T.e&&ye(N,"color",T.e=_e),we!==T.t&&ye(N,"text-shadow",T.t=we),T},{e:void 0,t:void 0}),N}})},Et,Tt),S(x=>At(b,{"ring-inset ring-[6px] ring-indigo-500/60 z-10":A()===o,"hover:brightness-105":!A()||A()!==o},x)),O(),b})()}})),r(xe,c(m,{get when(){return X(()=>!!n.data?.status)()&&n.data?.status!=="Ongoing"},get children(){var t=a(Gt),i=t.firstChild,o=i.firstChild,g=o.nextSibling,p=g.nextSibling;return r(o,(()=>{var f=X(()=>n.data?.status==="Timeout");return()=>f()?"Time Out!":n.data?.status})()),r(g,()=>{const f=n.data?.status,H=n.data?.turn;if(f==="Stalemate")return"Draw";const F=H==="White"?"Engine":"You";return f==="Timeout"?`${F} Wins by Time`:`${F} Wins`}),p.$$click=()=>R(),O(),t}}),et,tt),r(D,()=>v()==="White"?"Your Turn":"Waiting"),r(z,c(m,{get when(){return n.data?.timeControl!==0},get children(){var t=a(ke);return r(t,()=>re(We())),S(()=>y(t,`text-4xl font-mono font-bold mt-2 ${v()==="White"?"text-white":"text-stone-600"}`)),t}}),at,st),r(B,c(U,{get each(){return n.data?.capturedPieces?.black},children:t=>(()=>{var i=a(Me);return Se(i,"title",`Captured ${t}`),r(i,()=>Z.Black[t]),i})()}),me,ct),r(B,c(m,{get when(){return!n.data?.capturedPieces?.black?.length},get children(){return a(Ce)}}),gt,xt),r(Y,c(m,{get when(){return!k()},get children(){var t=a(zt);return t.$$click=Fe,S(()=>V(t,"disabled",C.isPending||(n.data?.moves?.length||0)===0)),O(),t}}),be,mt),r(Y,c(m,{get when(){return X(()=>v()==="White")()&&k()},get children(){var t=a(Yt),i=t.firstChild,o=i.nextSibling;return i.$$click=qe,r(i,c(m,{get when(){return j.isPending},get fallback(){return a(Zt)},get children(){return a(Dt)}})),o.$$click=Be,S(g=>{var p=j.isPending,f=j.isPending;return p!==g.e&&V(i,"disabled",g.e=p),f!==g.t&&V(o,"disabled",g.t=f),g},{e:void 0,t:void 0}),O(),t}}),ht,$t),S(t=>{var i=`text-xs font-bold uppercase tracking-wider ${v()==="Black"?"text-emerald-400":"text-stone-500"}`,o=`text-xs font-bold uppercase tracking-wider ${v()==="White"?"text-emerald-400":"text-stone-500"}`;return i!==t.e&&y(Q,t.e=i),o!==t.t&&y(D,t.t=o),t},{e:void 0,t:void 0}),e})()}qt(["click"]);export{on as component};
