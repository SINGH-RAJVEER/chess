import{u as et,c as tt,a as J,b as X,d as E,g as c,e as o,i as t,f as d,S as w,m as lt,h as nt,s as ot,r as Z,F as T,j as it,k as st,t as g,l as V,n as te,o as le,p as rt,q as at}from"./main-B62NIF3a.js";var ct=g('<div class="flex justify-between max-w-[800px] mx-auto mb-4"><div class="flex items-center space-x-2"><span class=font-bold>Black captured:</span><div class="flex space-x-1"></div></div><div class="flex items-center space-x-2"><span class=font-bold>White captured:</span><div class="flex space-x-1">'),ee=g("<span class=text-2xl>"),dt=g('<div class="text-red-500 font-bold">'),gt=g('<div class="text-green-500 font-bold">'),$t=g('<div class="text-xl font-bold p-4 bg-yellow-100 rounded text-center max-w-[800px] mx-auto">Game Over: <!$><!/>'),ut=g("<p class=text-center>Loading board..."),_t=g('<main class="w-full p-4 space-y-4"><div class="flex items-center justify-between max-w-[800px] mx-auto"><h2 class="font-bold text-3xl">Chess</h2><button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 cursor-pointer disabled:opacity-50"type=button></button></div><!$><!/><div class="messages-container max-w-[800px] mx-auto"style=min-height:1.5rem><!$><!/><!$><!/></div><!$><!/><div class=board><div style="position:absolute;top:-150px;left:820px;font-size:10px;background:white;padding:10px;border:1px solid black"><h4>Debug Info:</h4><div>Total pieces: <!$><!/></div><div>Turn: <!$><!/></div><div>Selected: <!$><!/></div><div>Valid moves: <!$><!/></div><div>Board loaded: <!$><!/></div><div>First 5 pieces: <!$><!/></div><div>Error: <!$><!/></div></div><!$><!/></div><!$><!/><!$><!/>'),bt=g("<button type=button>"),vt=g('<p class="text-center font-bold">Turn: <!$><!/>');console.log("API functions loaded:",{getBoard:!!le,getMoves:!!V,makeMove:!!te});const j={White:{Pawn:"♙",Knight:"♘",Bishop:"♗",Rook:"♖",Queen:"♕",King:"♔"},Black:{Pawn:"♟",Knight:"♞",Bishop:"♝",Rook:"♜",Queen:"♛",King:"♚"}};function ht(){const O=et(),i=tt(()=>({queryKey:["board"],queryFn:async()=>{console.log("Fetching board...");try{const e=await le();return console.log("✓ Board fetched successfully:",e),e}catch(e){throw console.error("✗ Failed to fetch board:",e),e}}})),ne=J(()=>({mutationFn:e=>te(e),onSuccess:()=>{O.invalidateQueries({queryKey:["board"]}),W("Move successful!"),setTimeout(()=>W(null),2e3)},onError:e=>{v(`Move failed: ${e instanceof Error?e.message:String(e)}`)}})),P=J(()=>({mutationFn:()=>rt(),onSuccess:()=>{O.invalidateQueries({queryKey:["board"]}),f(null),b([]),v(null)},onError:e=>{v(`Failed to reset game: ${e instanceof Error?e.message:String(e)}`)}})),m=X(()=>i.data?.pieces||[]),[B,f]=E(null),[S,b]=E([]),[q,v]=E(null),[U,W]=E(null),oe=e=>m().find($=>$.square===e),ie=async e=>{if(console.log(`
=== CLICK DEBUG ===`),console.log(`Clicked square: ${e}`),console.log(`Board data exists: ${!!i.data}`),console.log(`Pieces length: ${m().length}`),!i.data){console.log("No board data - returning");return}const r=m().find(l=>l.square===e),a=B();if(console.log(`Current turn: ${i.data.turn}`),console.log("Clicked piece:",r),console.log(`Selected square: ${a}`),r&&r.color===i.data.turn){if(console.log(`✓ Should select piece - matching turn (${r.color})`),a===e){console.log("Deselecting same square"),f(null),b([]);return}console.log(`Setting selected square to: ${e}`),f(e),v(null);try{console.log(`Calling getMoves for square: ${e}`),console.log("getMoves function type:",typeof V);const l=await V(e);console.log("✓ Got moves from API:",l),console.log(`Moves type: ${typeof l}, length: ${Array.isArray(l)?l.length:"not array"}`),b(l),console.log(`Set valid moves, length: ${Array.isArray(l)?l.length:"N/A"}`),console.log("After setting validMoves, validMoves():",S())}catch(l){console.error("✗ Failed to fetch moves:",l),console.error("Error type:",typeof l),console.error("Error message:",l?.message),v(`API Error: ${l?.message||"Unknown error"}`),b([])}return}else r?(console.log(`✗ Cannot select piece - wrong turn. Piece: ${r.color}, Turn: ${i.data.turn}`),v("Not your turn!")):console.log("✗ No piece clicked");a!==null?(console.log(`Checking move from ${a} to ${e}`),console.log("Current valid moves:",S()),S().includes(e)?(console.log("✓ Valid move - executing"),ne.mutate({from:a,to:e}),f(null),b([])):(console.log("✗ Invalid move or different target"),f(null),b([]))):console.log("No piece selected - cannot move"),console.log(`=== END CLICK DEBUG ===
`)},se=()=>{P.mutate()},re=()=>{const e=X(()=>i.data?.capturedPieces||{white:[],black:[]});return(()=>{var $=c(ct),r=$.firstChild,a=r.firstChild,l=a.nextSibling,k=r.nextSibling,A=k.firstChild,x=A.nextSibling;return t(l,d(T,{get each(){return e().white},children:y=>(()=>{var u=c(ee);return t(u,()=>j.White[y]),u})()})),t(x,d(T,{get each(){return e().black},children:y=>(()=>{var u=c(ee);return t(u,()=>j.Black[y]),u})()})),$})()};return(()=>{var e=c(_t),$=e.firstChild,r=$.firstChild,a=r.nextSibling,l=$.nextSibling,[k,A]=o(l.nextSibling),x=k.nextSibling,y=x.firstChild,[u,ae]=o(y.nextSibling),ce=u.nextSibling,[de,ge]=o(ce.nextSibling),$e=x.nextSibling,[H,ue]=o($e.nextSibling),F=H.nextSibling,z=F.firstChild,_e=z.firstChild,K=_e.nextSibling,be=K.firstChild,ve=be.nextSibling,[xe,he]=o(ve.nextSibling),N=K.nextSibling,pe=N.firstChild,me=pe.nextSibling,[fe,Se]=o(me.nextSibling),L=N.nextSibling,ye=L.firstChild,Ce=ye.nextSibling,[we,ke]=o(Ce.nextSibling),Q=L.nextSibling,Me=Q.firstChild,Ee=Me.nextSibling,[Pe,Be]=o(Ee.nextSibling),G=Q.nextSibling,qe=G.firstChild,Ae=qe.nextSibling,[Fe,Ke]=o(Ae.nextSibling),R=G.nextSibling,Ne=R.firstChild,Le=Ne.nextSibling,[Qe,Ge]=o(Le.nextSibling),Y=R.nextSibling,Re=Y.firstChild,De=Re.nextSibling,[Te,je]=o(De.nextSibling),Ve=z.nextSibling,[Oe,Ue]=o(Ve.nextSibling),We=F.nextSibling,[I,He]=o(We.nextSibling),ze=I.nextSibling,[Ye,Ie]=o(ze.nextSibling);return a.$$click=se,t(a,()=>P.isPending?"Resetting...":"Reset Game"),t(e,d(re,{}),k,A),t(x,d(w,{get when(){return q()},get children(){var n=c(dt);return t(n,q),n}}),u,ae),t(x,d(w,{get when(){return U()},get children(){var n=c(gt);return t(n,U),n}}),de,ge),t(e,d(w,{get when(){return lt(()=>!!i.data?.status)()&&i.data?.status!=="Ongoing"},get children(){var n=c($t),_=n.firstChild,s=_.nextSibling,[h,p]=o(s.nextSibling);return t(n,()=>i.data?.status,h,p),n}}),H,ue),t(K,()=>m().length,xe,he),t(N,()=>i.data?.turn,fe,Se),t(L,B,we,ke),t(Q,()=>S().length,Pe,Be),t(G,()=>i.isLoading?"Loading":"Loaded",Fe,Ke),t(R,()=>m().slice(0,5).map(n=>`${n.color[0]}${n.piece_type[0]}@${n.square}`).join(", "),Qe,Ge),t(Y,q,Te,je),t(F,d(T,{get each(){return Array.from({length:64})},children:(n,_)=>{const s=_(),h=Math.floor(s/8),p=s%8,D=(h+p)%2===1,M=oe(s),Je=B()===s,Xe=S().includes(s),Ze=s>=56&&s<=63?"debug-square":"";return(()=>{var C=c(bt);return C.$$click=()=>{console.log(`Clicking square ${s} (row ${h}, col ${p})`),ie(s)},nt(C,`square ${D?"black":"white"} ${Je?"selected":""} ${Xe?"valid-move":""} ${M?"has-piece":""} ${Ze}`),ot(C,"aria-label",`Square ${s}`),t(C,()=>M?j[M.color][M.piece_type]:""),Z(),C})()}}),Oe,Ue),t(e,d(w,{get when(){return i.data},children:n=>(()=>{var _=c(vt),s=_.firstChild,h=s.nextSibling,[p,D]=o(h.nextSibling);return t(_,()=>n().turn,p,D),_})()}),I,He),t(e,d(w,{get when(){return i.isLoading},get children(){return c(ut)}}),Ye,Ie),it(()=>st(a,"disabled",P.isPending)),Z(),e})()}at(["click"]);export{ht as component};
